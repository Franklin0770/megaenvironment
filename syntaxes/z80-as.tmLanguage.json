{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "AS - Zilog Z80",
	"scopeName": "source.z80-as",
	"foldingStartMarker": "^\\s*(?i:macro|ifn?(?:def|symexist|used|exist|b)?|rept|irpc?|while|function|struct|switch)\\b",
	"foldingStopMarker": "^\\s*(?i:end(?:if|struct|case|m))\\b",
	"patterns": [
		{ "include": "#instructions" },
		{ "include": "#instruction-label-structure" },
		{ "include": "#variables" },
		{ "include": "#constants" },
		{ "include": "#comments" },
		{ "include": "#labels" },
		{ "include": "#strings" },
		{ "include": "#operators" },
		{ "include": "#pseudo-instructions" },
		{ "include": "#symbols" },
		{ "include": "#functions" }
	],
	"repository": {
		"instructions": {
			"patterns": [
				{
					"name": "instruction.mnemonic.as",
					"match": "\\b(?i:ld[id]?|ld[id]r|inc|dec|ad[dc]|sub|sbc|and|x?or|cpl?|exx?|push|pop|cp[id]r?|nop|bit|s[lr]a|srl|r[rl]d|r[lr]c?a?|set|res|[ed]i|im|halt|daa|neg|[cs]cf|ini?r?|indr?|out[ir]?|ot[id]r)\\b"
				},
				{
					"name": "instruction.jump.as",
					"match": "\\b(?i:j[pr]|call|djnz|ret[in]|rst)\\b(?!\\s+(?:\\$\\$|[\\w+-]))"
				}
			]
		},
		"variables": {
			"name": "variable.register.as",
			"match": "\\b(?i:af'?|bc|de|hl|i[xy]|sp|a|b|c|d|e|h|l|r|i)(?![\\w'])"
		},
		"constants": {
			"name": "constant.numeric.as",
			"match": "(?<![\\w\\)])-?(?:\\d{1,5}|[0-9a-fA-F]{1,4}h|[01]{1,16}b|[0-7]{1,6}[oq])(?!\\w)"
		},
		"comments": {
			"name": "directive.comment.as",
			"match": "\\;.*$"
		},
		"strings": {
			"patterns": [
				{
					"name": "directive.string.as",
					"begin": "\"",
					"end": "\""
				},
				{
					"name": "directive.string.as",
					"begin": "'",
  					"end": ""
				}
			]
		},
		"labels": {
			"patterns": [
				{
					"name": "directive.label.global.as",
					"match": "(?:^\\w+:?)|(?:\\s\\w+:)"
				},
				{
					"name": "directive.label.local.as",
					"match": "(?:^\\.[\\w\\.]+:?)|(?:\\s\\.[\\w\\.]+:)"
				},
				{
					"name": "directive.label.temporary.as",
					"match": "(?:^\\$\\$[\\w\\.]+:?)|(?:\\s\\$\\$[\\w\\.]+:)"
				},
				{
					"name": "directive.label.nameless.as",
					"match": "^[+-]$"
				}
			]
		},
		"operators": {
			"name": "directive.operator.as",
			"match": "(?:\\w[\\s\\(]?)?\\K(?::=|==|!=|<=|>=|<>|<<|>>|\\|\\||&&|!!|><|[-+*\\/#^~|&=<>!])"
		},
		"functions": {
			"name": "directive.function.as",
			"match": "(?i:sqrt|a?sinh?|a?cosh?|a?tanh?|a?coth?|exp|a?log|a?ld|ln|int|bit(?:cnt|pos)|(?:first|last)bit|sgn|abs|to(?:upper|lower)|(?:up|low)string|strlen|substr|charfromstr|strstr|val|exprtype|fsize|symused)(?=\\([^)\n]+\\))"
		},
		"symbols": {
			"name": "directive.symbol.as",
			"match": "(?<!\\w)(?:TRUE|FALSE|MOMCPU(?:NAME)?|CONSTPI|FLOATMAX|VERSION|ARCHITECTURE|DATE|TIME|FILE|LINE|PASS|SECTION)|[\\.\\$](?![\\w\\$])"	
		},
		"pseudo-instructions": {
			"name": "directive.pseudo.as",
			"match": "\\b(?i:d[cs]|set|equ|b?include|r?org|cpu|(?:de)?phase|rept|macro|function|endm?|(?:end)?struct|(?:end)?if|ifn?(?:def|symexist|used|exist|b)|else(?:if)?|switch|(?:else|end)?case|while|page(?:size)?|listing|padding|save|restore|align|message|warning|error|fatal|label|charset|codepage|pushv|popv|(?:sup|comp)mode|intsyntax|relaxed|segment|assume|(?:end)?expect|irpc?|exitm|shift|maxnest|newpage|macexp_(?:dft|ovr)|title|(?:out)?radix|public|global|forward|shared|read)\\b"
		},
		"instruction-label-structure": {
			"patterns": [
				{
					"match": "\\b(?i:(j[pr]|call))\\b\\s+((?i:\\b(?:z|nz|c|nc|p|pe|po|m)\\b))\\s*,\\s*((?:\\.|\\$\\$)?(?:[\\w\\.]+))",
					"captures": {
						"1": { "name": "instruction.jump.as" },
						"2": { "name": "variable.flag.as" },
						"3": { "name": "directive.label.jump.as" }
					}
				},
				{
					"match": "\\b(?i:(j[pr]|call|djnz))\\b\\s+((?:\\.|\\$\\$)?[\\w\\.]+)\\b(?!\\s*,)",
					"captures": {
						"1": { "name": "instruction.jump.as" },
						"2": { "name": "directive.label.jump.as" }
					}
				},
				{
					"match": "\\b(?i:(ret))\\b\\s+((?i:\\b(?:z|nz|c|nc|p|pe|po|m)\\b))?",
					"captures": {
						"1": { "name": "instruction.jump.as" },
						"2": { "name": "variable.flag.as" }
					}
				}
			]
		}
	}
}